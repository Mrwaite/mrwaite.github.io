<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Nodejs单元测试 · Mrwaite`s Blog</title><meta name="description" content="Nodejs单元测试 - Mrwaite"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://code.mrwaite.cn/atom.xml" title="Mrwaite`s Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Nodejs单元测试</h1><div class="post-info">2016年7月29日</div><div class="post-content"><div class="note info"><h2>使用模块</h2></div>

<h3 id="mocha"><a href="#mocha" class="headerlink" title="mocha"></a><a href="https://mochajs.org" target="_blank" rel="external">mocha</a></h3><p>@转载自阮一峰：<a href="http://www.ruanyifeng.com/blog/2015/12/a-mocha-tutorial-of-examples.html" target="_blank" rel="external">测试框架Mocha实例教程</a><br>JavaScript测试框架之一，能在浏览器和Node环境使用。可以通过它为JavaScript应用添加测试，从而保证代码的质量。  </p>
<p>为了方便起见，在全句环境安装<code>mocha</code>：<code>npm install -g mocha</code></p>
<p>通常测试脚本与所要测试的源码脚本同名，但是后缀名为<code>.test.js</code>（表示测试）或者<code>.spex.js</code>（表示规格）。比如<code>add.jd</code>的测试脚本名称为<code>add.test.js</code>。   </p>
<p>在<code>mocha</code>语法里面：<br><code>describe</code>块称为“测试套件”，表示一组相关的测试。它是一个函数，第一个参数是测试套件的名称，第二个参数是一个实际执行的函数。<br><code>it</code>块称为“测试用例”，表示一个单独的测试，为测试的最小单位。它是一个函数，第一个参数是测试用例的名称，第二个参数是一个实际执行的函数。  </p>
<p><code>describe</code>块孩提供了测试用例的四个hook： <code>before()</code>,<code>after()</code>,<code>beforeEach()</code>,<code>afterEach()</code>     </p>
<a id="more"></a>
<p><strong>注意</strong>：<br>在协作项目的时候应该考虑<code>mocha</code>的版本问题，因为在不同版本的<code>mocha</code>下是不兼容的。这时应该注意：  </p>
<ol>
<li><code>$ npm i mocha --save-dex</code>， 安装一个局部的<code>mocha</code>到项目目录中去</li>
<li><code>$ ./node_modules/.bin/mocha</code>， 用刚才安装的局部的<code>mocha</code>来跑测试代码<br>但是每次这样的输入很麻烦。可以通过使用<code>Makefile</code>帮助我们记住复杂的配置，详见：<a href="https://github.com/alsotang/node-lessons/blob/master/lesson6/README.md" target="_blank" rel="external">包教不包会</a>，<a href="http://blog.csdn.net/haoel/article/details/2886" target="_blank" rel="external">Makefile详解</a>。</li>
</ol>
<h3 id="should"><a href="#should" class="headerlink" title="should"></a><a href="https://github.com/tj/should.js" target="_blank" rel="external">should</a></h3><p><code>should</code>是断言库模块之一，什么是“断言”？“断言”就是判断源码的实际执行结果与预期的执行结果是否一致，如果不一致就抛出错误。   </p>
<p>所有的测试用例（<code>it</code>块）都应该包含有一句或者多句断言。它是编写测试用例的关键。  </p>
<p><code>mocha</code>为了保持自己的灵活性，因此默认不提供断言的<code>API</code>。在Nodejs中mocha和should是协作完成的。</p>
<p>@转载自淘宝FED：<a href="https://github.com/tj/should.js" target="_blank" rel="external">断言库的比较</a><br>断言库 | 优点 | 缺点 | 备注<br>— | — | — | —<br>Nodejs核心库Assert | 无需第三方依赖 | 语法较烂 | -<br>Should.js | API比较语义 | 文档比较烂 | -<br>expect.js | - | - | 比较中庸<br>chai | 大而全的API | - | -</p>
<h3 id="istanbul"><a href="#istanbul" class="headerlink" title="istanbul"></a><a href="https://www.npmjs.com/package/istanbul" target="_blank" rel="external">istanbul</a></h3><p>Nodejs覆盖率统计工具。<br>作用：提供一系列指标取衡量单元测试覆盖了哪些功能代码。istanbul提供了代码的语句覆盖率，分支覆盖率，函数覆盖率和行覆盖率的统计。   </p>
<div class="note info"><h2>知识集成</h2></div>

<h3 id="单元测试类型"><a href="#单元测试类型" class="headerlink" title="单元测试类型"></a>单元测试类型</h3><ol>
<li>TDD（测试驱动开发）</li>
<li>BDD（行为驱动开发）</li>
</ol>
<h3 id="持续集成"><a href="#持续集成" class="headerlink" title="持续集成"></a>持续集成</h3><p>@转载自阮一峰 ： <a href="http://www.ruanyifeng.com/blog/2015/09/continuous-integration.html" target="_blank" rel="external">持续集成是上面？</a><br><strong>持续集成指的是 频繁的（一天多次）将代码集成到主干。 </strong><br>好处：  </p>
<ol>
<li>快速发现错误。每天完成一点更新，集成到主干，快速发现并定位错误。</li>
<li>防止分支大幅度偏离主干。如果不是经常集成，主干又在不断更新，会导致以后集成难度越来越大。<br><strong>持续集成的目的是为了让偿命快速迭代，同时还能保证高质量</strong>,核心措施是，代码集成到主干之前，必须通过自动化测试。只要有一个测试用例失败就不能集成。</li>
</ol>
<p>这里贴上蓬stephen蓬的评论：  </p>
<blockquote>
<p>阮老师讲的“持续集成”，正好是我在公司做了将近半年多互联网项目的一个工作流程。我们项目经历了两期，每期都要进行十几次迭代，每次迭代都会在上一个迭代的基&gt; 础上增加几个新功能，并且公司要求开发人员在编码前要先提交该功能的单体测试和集成测试的代码，然后才能开始写代码（所谓的测试驱动开发），然后测试人员要负&gt; 责写端到端的自动化测试代码。公司用Jenkins进行持续集成，SVN管理代码库，Git进行团队开发，Sonar进行代码质量检查。项目成员每天早晨都会收到Jenkins服务&gt; 器发来的前一天的集成测试报告，通知前一天的提交是否完全通过。经历了这样一个持续迭代的过程，给客户交付的代码质量有保证，很少或几乎没有出现过回滚的情况。</p>
</blockquote>
<h3 id="npm-使用积累"><a href="#npm-使用积累" class="headerlink" title="npm 使用积累"></a>npm 使用积累</h3><p><code>npm</code>的<code>package.json</code>提供了三种依赖关系的定义：   </p>
<ol>
<li>dependencies</li>
<li>peerDependencies</li>
<li>devDependencies<br>其中<code>devDependencies</code>是开发是依赖的，比如模块用<code>mocha</code>来测试框架，那么模块开发就依赖<code>mocha</code>,如果别人想为你的模块贡献代码，他也需要安装<code>mocha</code>。但是只是用你模块的人就没必要安装<code>mocha</code>。<br><code>perrDependencies</code>是为插件准备的。比如<code>grunt</code>的插件，里面没有<code>require(&#39;grunt&#39;)</code>，所以用dependencies就有问题。所以需要单独列出来。</li>
</ol>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>Ubuntu下用命令行快速打开各种类型的文件：<code>xdg-open &lt;filename&gt;</code></p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/08/10/读JavaScript语言精粹收获/" class="prev">PREV</a><a href="/2016/07/28/nodejs爬虫编写时的一些收获/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://code.mrwaite.cn">Mrwaite</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>